

# ELF 文件的调试信息组织

ELF（Executable and Linkable Format）文件是 Unix 系统（包括 Linux）中用于可执行文件、共享库和目标文件的标准格式。调试信息是调试器用来映射源代码与生成的机器代码之间的关系的内容。在 ELF 文件中，调试信息通常是作为符号表和相关的调试节段（sections）存储的。

### ELF 文件中的调试信息

调试信息在 ELF 文件中通常存储在一些特定的节段中，主要包括以下几类：

#### 1. **符号表（.symtab 和 .dynsym）**
   - **`.symtab`**：这是 ELF 文件的符号表，包含了程序中的所有符号（如变量、函数名等）。它提供了源代码到二进制代码的映射，是调试器最常用的调试信息之一。符号表中的每个符号都有相关的地址信息。
   - **`.dynsym`**：动态符号表，包含了动态链接过程中所需的符号（通常用于共享库）。它与 `.symtab` 类似，但主要用于动态链接时的符号解析。

   调试器可以通过符号表找出哪些函数和变量在代码中定义以及它们的地址。

#### 2. **调试信息节段（.debug_*）**
   调试信息被存储在以 `.debug_` 为前缀的节段中，具体包括以下几种：
   
   - **`.debug_info`**：包含了详细的调试信息，通常包括函数的名称、参数、变量、类型信息、源代码行号等。这些信息是最详细的调试数据，对于源代码和二进制的映射至关重要。
   - **`.debug_abbrev`**：包含了调试符号的缩写（abbreviations），这是对 `.debug_info` 中信息的压缩形式，主要用于提高存储效率。
   - **`.debug_line`**：包含了行号信息，指示每个源代码行与程序执行代码之间的关系。这使得调试器能够将机器代码映射到源代码中的具体行号。
   - **`.debug_str`**：包含调试符号表的字符串（如函数名、变量名等）。
   - **`.debug_loc`**：包含调试信息中符号的位置，通常指示变量的内存地址和范围。

   这些节段是调试信息的核心，它们包含了程序的源代码位置、变量的定义和类型等信息，调试器通过这些数据将二进制代码映射回源代码。

#### 3. **类型信息（.debug_types）**
   - **`.debug_types`**：包含类型信息，如结构体、类、枚举、联合体等的定义。这些信息对于调试时查看复杂数据类型的内容非常有用。

#### 4. **其它调试相关节段**
   - **`.note`**：某些 ELF 文件会包含一个 `.note` 节段，这里可能包含一些特定于调试的信息，尽管它通常用于存储平台和目标特定的信息（比如目标架构信息）。
   - **`.plt` 和 `.got`**：这些不是专门的调试节段，而是与动态链接相关的节段。在调试时，调试器可能会用它们来追踪动态链接的函数调用。

### 调试信息的格式

在 ELF 文件中，调试信息的格式通常遵循 **DWARF** 标准。DWARF 是一种专门为调试目的设计的数据格式，它被广泛用于许多编程语言和平台。DWARF 定义了如何存储变量、函数、类型和源代码行号等信息。

- **DWARF 信息结构**：在 `.debug_info` 和其他节段中，调试信息以一系列的 **debugging entries** 存储，每个条目描述了符号、变量、函数等的信息。
- **DWARF 表示法**：DWARF 采用一种表格格式，其中每个表格项对应一个源代码元素或符号，记录了源代码行号、符号名称、地址等信息。

### 不包含源代码文本

尽管 ELF 文件的调试信息中包含源代码的行号、符号等映射信息，但 **并不会直接存储源代码中的每一行文本内容**。具体来说，调试信息在 ELF 文件中的作用是：
- **源代码行号的映射**：调试信息通过 `.debug_line` 节段来存储源代码行号与机器代码之间的映射。它指出了某一段机器代码对应源代码中的哪一行。这使得调试器能够显示在调试时程序执行到哪一行源代码。
- **源代码文件的路径**：调试信息还包含了源代码文件的路径信息，这使得调试器能够知道源代码文件在哪里，以便在调试过程中打开这些文件。

调试信息中 **不存储源代码文本本身**，而是通过符号表、行号表等信息，帮助调试器将二进制代码映射回源代码的位置。源代码文本内容本身并不包含在 ELF 文件中，除非显式地将源代码嵌入到程序中（例如某些特殊的 `#include` 或调试用途），但这并不是调试信息的一部分。

### 如何生成和使用调试信息

调试信息通常在编译时生成。比如使用 `gcc` 编译时，可以通过添加 `-g` 选项来生成调试信息：

```bash
gcc -g -o my_program my_program.c
```

这将会在生成的 ELF 文件中包含调试信息。编译后的 ELF 文件会包含 `.debug_*` 节段，调试器（如 GDB）会利用这些信息来帮助开发者调试程序。

### 如何查看调试信息

你可以使用 `objdump` 或 `readelf` 等工具来查看 ELF 文件中的调试信息。例如，使用 `readelf` 查看调试信息：

```bash
readelf --debug-dump=info my_program
```

这会显示 `.debug_info` 节段的内容，其中包括与源代码行号、符号等相关的信息。
