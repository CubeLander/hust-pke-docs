# ELF文件概述

## 1. 文件读取与格式验证
- **读取 ELF 文件头**  
  当操作系统收到加载请求时，首先从磁盘中读取 ELF 文件头，以验证文件是否为 ELF 格式，并获取文件的基本信息（如文件类型、目标架构、程序入口点等）。ELF 头部包含了程序头表和节区表的偏移和大小信息，为后续步骤指明方向。

## 2. 解析程序头表与加载段
- **读取程序头表**  
  程序头表描述了文件中各个段的位置、大小和属性，包含段类型、虚拟地址、文件偏移、大小及对齐要求等信息。
- **加载段到内存**  
  对于每个标记为 PT_LOAD 的段，操作系统会将该段从文件映射到进程的虚拟地址空间中，并设置适当的访问权限。

## 3. 动态链接（如果适用）
- **动态链接的 ELF 文件**  
  对于依赖共享库的 ELF 文件，操作系统会加载动态链接器并执行重定位与符号解析，确保所有函数调用和数据引用指向正确的内存位置。

## 4. 环境设置与入口点准备
- **初始化运行环境**  
  为新进程建立干净的运行环境，包括设置堆栈、初始化资源（如文件描述符、信号处理等）。
- **确定入口点**  
  操作系统将程序计数器（PC）设置为 ELF 头部指定的程序入口点地址，准备启动程序。

## 5. 开始执行
- **控制权转交**  
  操作系统将 CPU 控制权交给新加载的程序，从入口点开始执行第一条指令，程序开始运行。

---

## 总结
ELF 文件加载和执行过程如同一场精密协调的交响乐：
1. **起始序曲**：文件头解析，确定格式与基本信息。
2. **主旋律**：程序头表指引下的各个段加载到内存中。
3. **和声处理**：动态链接阶段，完成依赖和重定位工作，确保各部分协同工作。
4. **大合奏**：环境设置与入口点确定，CPU 接管控制，程序开始执行。

每一步都充满了技术严谨与艺术韵律，这种精细有序的安排确保了计算机高效、安全地执行程序。
