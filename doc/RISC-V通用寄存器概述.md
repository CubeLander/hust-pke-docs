# RISC-V 寄存器体系结构概述

RISC-V 体系结构采用精简而灵活的设计，定义了 32 个通用寄存器（x0～x31）以及一系列控制状态寄存器（CSR）。通用寄存器用于存放数据、传递函数参数、保存返回地址和临时计算结果，而 CSR 则管理处理器状态、异常处理、地址转换等。本文主要介绍通用寄存器的作用和典型用途。

---

## 1. 通用寄存器

在 RISC-V 中，共有 32 个通用寄存器，每个寄存器在 RV32 实现中为 32 位，在 RV64 实现中为 64 位。为了方便理解和使用，这些寄存器通常都有固定的名称和约定用途，具体如下：

### 1.1 寄存器 x0 —— zero
- **名称**：zero  
- **功能**：始终为 0。对 x0 的任何写入都会被忽略，其值永远固定为 0。  
- **用途**：作为“零值”常量使用，消除不需要的运算结果。

### 1.2 寄存器 x1 —— ra (Return Address)
- **名称**：ra  
- **功能**：保存函数调用的返回地址。  
- **用途**：在调用指令中自动保存返回地址，用于函数返回时恢复。

### 1.3 寄存器 x2 —— sp (Stack Pointer)
- **名称**：sp  
- **功能**：指向当前调用栈的栈顶。  
- **用途**：管理局部变量、返回地址和调用现场，实现函数入栈和出栈操作。

### 1.4 寄存器 x3 —— gp (Global Pointer)
- **名称**：gp  
- **功能**：指向全局数据区的起始地址。  
- **用途**：方便访问全局变量和静态数据。

### 1.5 寄存器 x4 —— tp (Thread Pointer)
- **名称**：tp  
- **功能**：指向当前线程的线程局部存储（TLS）区域。  
- **用途**：实现线程安全的局部变量存取。

### 1.6 临时寄存器 —— t0 到 t2 (x5～x7)
- **名称**：t0, t1, t2  
- **功能**：用于存放临时计算数据和中间运算结果。  
- **用途**：作为临时存储空间，在函数调用前后不保证这些寄存器的值。

### 1.7 保存寄存器 / 帧指针 —— s0/fp 和 s1 (x8、x9)
- **名称**：s0（也作为 fp，即帧指针）、s1  
- **功能**：用于保存跨函数调用需要保持的值。  
- **用途**：s0 可用作帧指针，指向当前函数栈帧的基地址，便于访问局部变量和参数。

### 1.8 参数与返回值寄存器 —— a0 到 a7 (x10～x17)
- **名称**：a0, a1, a2, a3, a4, a5, a6, a7  
- **功能**：用于传递函数参数以及存放函数返回值。  
- **用途**：在函数调用时，第 0 个和第 1 个参数通常也用于传递返回值。

### 1.9 额外保存寄存器 —— s2 到 s11 (x18～x27)
- **名称**：s2, s3, s4, s5, s6, s7, s8, s9, s10, s11  
- **功能**：用于保存需要在函数调用之间保持不变的值。  
- **用途**：在函数调用过程中，如果使用这些寄存器，需保存并在返回前恢复。

### 1.10 临时寄存器 —— t3 到 t6 (x28～x31)
- **名称**：t3, t4, t5, t6  
- **功能**：用于临时计算或存储中间结果。  
- **用途**：在复杂运算中作为短期数据存储。

---

## 2. 控制状态寄存器（CSR）

除了上述通用寄存器外，RISC-V 还定义了许多控制状态寄存器（CSR），这些寄存器对操作系统内核及底层硬件管理至关重要。常见的 CSR 包括：
- **mstatus**：记录全局中断使能、当前特权级以及其他处理器状态信息。
- **mepc**：用于保存异常发生时的返回地址。
- **mtvec**：指定异常处理程序的入口地址。
- **scause、sepc、stvec、sstatus**：在 Supervisor 模式下管理异常处理和系统调用。

---

## 3. 调用约定

RISC-V 的调用约定规定了在函数调用过程中各个寄存器的保存和使用规则：
- **调用者保存（Caller-saved）寄存器**：包括参数/返回值寄存器 a0～a7 以及临时寄存器 t0～t6。调用者需要保留这些寄存器的值时，需在调用前保存。
- **被调用者保存（Callee-saved）寄存器**：包括保存寄存器 s0（/fp）到 s11。被调用函数在使用这些寄存器前需保存并在返回前恢复。

---

## 4. 总结

RISC-V 寄存器体系结构简洁而功能明确，分为常数寄存器、返回地址与栈指针、全局与线程指针、临时与保存寄存器、参数与返回值传递寄存器等多个类别，同时通过控制状态寄存器（CSR）管理特权级和异常处理。正确理解并合理使用这些寄存器对高效编程、编译器优化和操作系统内核开发至关重要。
